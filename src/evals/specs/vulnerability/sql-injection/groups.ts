import type { EvalGroupSpec } from "../../../types.js";

const NEXTJS_CASE = "cases/nextjs-baseline";
const NEXTJS_FAKEOUT_1_CASE = "cases/nextjs-fakeout-1";
const SUPABASE_CASE = "cases/supabase-baseline";

export const SQL_INJECTION_GROUPS: EvalGroupSpec[] = [
  {
    id: "SQLI-Nextjs-Baseline",
    description: "SQL injection baseline fixtures (Next.js) in hadrix-evals-sql-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_CASE}/app/api/projects/[id]/route.ts`,
        expectation: "SQL injection: raw SQL built by concatenating the project id into a query string",
        severity: "critical",
      },
      {
        filepath: `${NEXTJS_CASE}/lib/unsafeSql.ts`,
        expectation: "Unsafe raw SQL execution helper used by Next.js route handlers",
        severity: "high",
      },
      {
        filepath: `${NEXTJS_CASE}/app/api/projects/route.ts`,
        expectation:
          "Unsafe query-builder usage: user-controlled `.or()` filter string passed to Supabase query builder",
        severity: "high",
      },
    ],
  },
  {
    id: "SQLI-Nextjs-Fakeout1",
    description: "SQL injection fakeout fixtures (Next.js) in hadrix-evals-sql-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_FAKEOUT_1_CASE}/app/api/projects/[id]/route.ts`,
        expectation: "SQL injection: raw SQL built by interpolating the project id into a WHERE clause",
        severity: "critical",
      },
      {
        filepath: `${NEXTJS_FAKEOUT_1_CASE}/lib/queryExecutor.ts`,
        expectation: "Raw SQL execution helper runs unparameterized SQL statements",
        severity: "high",
      },
    ],
  },
  {
    id: "SQLI-Supabase-Baseline",
    description: "SQL injection baseline fixtures (React Supabase) in hadrix-evals-sql-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/get-project.ts`,
        expectation: "SQL injection: raw SQL built by concatenating the project id into a query string",
        severity: "critical",
      },
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/_shared/unsafeSql.ts`,
        expectation: "Unsafe raw SQL execution helper used by Edge Functions (no parameterization)",
        severity: "high",
      },
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/list-projects.ts`,
        expectation:
          "Unsafe query-builder usage: user-controlled `.or()` filter string passed directly to PostgREST query builder",
        severity: "high",
      },
    ],
  },
];
