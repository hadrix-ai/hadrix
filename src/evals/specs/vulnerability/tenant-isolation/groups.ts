import type { EvalGroupSpec } from "../../../types.js";

const NEXTJS_CASE = "cases/nextjs-baseline";
const NEXTJS_FAKEOUT_1_CASE = "cases/nextjs-fakeout-1";
const SUPABASE_CASE = "cases/supabase-baseline";
const BROKENCRYSTALS_CASE = "cases/brokencrystals-baseline";

export const TENANT_ISOLATION_GROUPS: EvalGroupSpec[] = [
  {
    id: "TENANT-ISOLATION-Nextjs-Baseline",
    description: "Tenant isolation baseline fixtures (Next.js) in hadrix-evals-tenant-isolation",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_CASE}/app/api/projects/route.ts`,
        expectation:
          "Cross-tenant leakage: client-controlled orgId used to filter project listings without membership verification",
        severity: "high",
      },
      {
        filepath: `${NEXTJS_CASE}/app/actions/createProject.ts`,
        expectation: "Server action trusts client orgId for project creation",
        severity: "high",
      },
    ],
  },
  {
    id: "TENANT-ISOLATION-Nextjs-Fakeout1",
    description: "Tenant isolation fakeout fixtures (Next.js) in hadrix-evals-tenant-isolation",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_FAKEOUT_1_CASE}/app/api/projects/route.ts`,
        expectation:
          "Cross-tenant leakage: org mismatch logged but client-controlled orgId still used for project access",
        severity: "high",
      },
      {
        filepath: `${NEXTJS_FAKEOUT_1_CASE}/app/actions/createProject.ts`,
        expectation: "Server action trusts client orgId for project creation",
        severity: "high",
      },
    ],
  },
  {
    id: "TENANT-ISOLATION-Supabase-Baseline",
    description: "Tenant isolation baseline fixtures (React Supabase) in hadrix-evals-tenant-isolation",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/list-projects.ts`,
        expectation:
          "Cross-tenant leakage: client-controlled orgId used to filter project listings without membership verification",
        severity: "high",
      },
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/create-project.ts`,
        expectation: "Server function trusts client orgId for project creation",
        severity: "high",
      },
    ],
  },
  {
    id: "TENANT-ISOLATION-BrokenCrystals",
    description: "Tenant isolation fixtures (BrokenCrystals) in hadrix-evals-tenant-isolation",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${BROKENCRYSTALS_CASE}/server/routes/tenants.ts`,
        expectation: "Tenant isolation failure: orgId from request scopes queries without membership checks",
        severity: "high",
      },
    ],
  },
];
