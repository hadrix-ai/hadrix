import type { EvalGroupSpec } from "../../../types.js";

const NEXTJS_CASE = "cases/nextjs-baseline";
const NEXTJS_FAKEOUT_1_CASE = "cases/nextjs-fakeout-1";
const SUPABASE_CASE = "cases/supabase-baseline";
const BROKENCRYSTALS_CASE = "cases/brokencrystals-baseline";
const NODEVULNERABLE_CASE = "cases/nodevulnerable-baseline";
const NODEGOAT_CASE = "cases/nodegoat-baseline";

export const COMMAND_INJECTION_GROUPS: EvalGroupSpec[] = [
  {
    id: "CMDI-Nextjs-Baseline",
    description: "Command injection baseline fixtures (Next.js) in hadrix-evals-command-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_CASE}/app/api/scan/route.ts`,
        expectation: "Command injection: repoUrl concatenated into shell command when toggle enabled",
        severity: "critical",
      },
    ],
  },
  {
    id: "CMDI-Nextjs-Fakeout1",
    description: "Command injection fakeout fixtures (Next.js) in hadrix-evals-command-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_FAKEOUT_1_CASE}/app/api/scan/route.ts`,
        expectation: "Command injection: repoUrl validated as a URL but still concatenated into a shell command",
        severity: "critical",
      },
    ],
  },
  {
    id: "CMDI-Supabase-Baseline",
    description: "Command injection baseline fixtures (React Supabase) in hadrix-evals-command-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/scan-repo.ts`,
        expectation: "Command injection: repoUrl concatenated into shell command when toggle enabled",
        severity: "critical",
      },
    ],
  },
  {
    id: "COMMAND-INJECTION-BrokenCrystals",
    description: "Command injection fixtures (BrokenCrystals) in hadrix-evals-command-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${BROKENCRYSTALS_CASE}/server/routes/spawn.ts`,
        expectation: "Command injection: user input concatenated into a shell command",
        severity: "critical",
      },
    ],
  },
  {
    id: "CMDI-NodeVulnerable",
    description: "Command injection fixtures (NodeVulnerable) in hadrix-evals-command-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NODEVULNERABLE_CASE}/server/routes/diagnostics.ts`,
        expectation: "Command injection: host concatenated into a ping shell command",
        severity: "critical",
      },
    ],
  },
  {
    id: "CMDI-NodeGoat",
    description: "Command injection fixtures (NodeGoat) in hadrix-evals-command-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NODEGOAT_CASE}/server/routes/backup.ts`,
        expectation: "Command injection: database name concatenated into a mongodump shell command",
        severity: "critical",
      },
    ],
  },
];
