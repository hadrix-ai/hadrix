import type { EvalGroupSpec } from "../../../types.js";

const NEXTJS_CASE = "cases/nextjs-baseline";
const NEXTJS_FAKEOUT_1_CASE = "cases/nextjs-fakeout-1";
const SUPABASE_CASE = "cases/supabase-baseline";
const BROKENCRYSTALS_CASE = "cases/brokencrystals-baseline";
const NODEGOAT_CASE = "cases/nodegoat-baseline";
const NODEVULNERABLE_CASE = "cases/nodevulnerable-baseline";

export const XSS_GROUPS: EvalGroupSpec[] = [
  {
    id: "XSS-Nextjs-Baseline",
    description: "XSS baseline fixtures (Next.js) in hadrix-evals-xss",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_CASE}/app/projects/[id]/page.tsx`,
        expectation:
          "Stored XSS: dangerouslySetInnerHTML renders project.description_html without sanitization when the toggle is enabled",
        ruleId: "dangerous_html_render",
        severity: "high",
        startLine: 72,
        endLine: 72,
      },
    ],
  },
  {
    id: "XSS-Nextjs-Fakeout1",
    description: "XSS fakeout fixtures (Next.js) in hadrix-evals-xss",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_FAKEOUT_1_CASE}/app/projects/[id]/page.tsx`,
        expectation:
          "Stored XSS: dangerouslySetInnerHTML renders project.description_html after only stripping script tags",
        ruleId: "dangerous_html_render",
        severity: "high",
        startLine: 54,
        endLine: 54,
      },
    ],
  },
  {
    id: "XSS-Supabase-Baseline",
    description: "XSS baseline fixtures (React Supabase) in hadrix-evals-xss",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${SUPABASE_CASE}/frontend/app/projects/[id]/page.tsx`,
        expectation:
          "Stored XSS: dangerouslySetInnerHTML renders project.description_html without sanitization when the toggle is enabled",
        ruleId: "dangerous_html_render",
        severity: "high",
        startLine: 41,
        endLine: 41,
      },
    ],
  },
  {
    id: "XSS-BrokenCrystals",
    description: "XSS fixtures (BrokenCrystals) in hadrix-evals-xss",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${BROKENCRYSTALS_CASE}/client/TestimonialCard.tsx`,
        expectation: "Stored XSS: dangerouslySetInnerHTML renders testimonial body without sanitization",
        ruleId: "dangerous_html_render",
        severity: "high",
        startLine: 11,
        endLine: 11,
      },
    ],
  },
  {
    id: "XSS-NodeGoat",
    description: "XSS fixtures (NodeGoat) in hadrix-evals-xss",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NODEGOAT_CASE}/server/routes/search.ts`,
        expectation: "Reflected XSS: query string is rendered into an HTML response without sanitization",
        ruleId: "dangerous_html_render",
        severity: "high",
        startLine: 6,
        endLine: 6,
      },
    ],
  },
  {
    id: "XSS-NodeVulnerable",
    description: "XSS fixtures (NodeVulnerable) in hadrix-evals-xss",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NODEVULNERABLE_CASE}/server/routes/preview.ts`,
        expectation: "Reflected XSS: untrusted message content is injected into an HTML response",
        ruleId: "dangerous_html_render",
        severity: "high",
        startLine: 6,
        endLine: 6,
      },
    ],
  },
];
