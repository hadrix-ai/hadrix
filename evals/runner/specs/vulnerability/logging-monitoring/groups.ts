import type { EvalGroupSpec } from "../../../types.js";

const NEXTJS_CASE = "cases/nextjs-baseline";
const NEXTJS_FAKEOUT_1_CASE = "cases/nextjs-fakeout-1";
const SUPABASE_CASE = "cases/supabase-baseline";
const BROKENCRYSTALS_CASE = "cases/brokencrystals-baseline";
const NODEGOAT_CASE = "cases/nodegoat-baseline";

export const LOGGING_MONITORING_GROUPS: EvalGroupSpec[] = [
  {
    id: "LOGGING-MONITORING-Nextjs-Baseline",
    description:
      "Logging & monitoring baseline fixtures (Next.js) in hadrix-evals-logging-monitoring",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_CASE}/lib/audit.ts`,
        expectation: "Audit logging and alerts can be disabled for sensitive actions",
        ruleId: "missing_audit_logging",
        severity: "high",
        startLine: 4,
        endLine: 5,
      },
      {
        filepath: `${NEXTJS_CASE}/app/api/projects/route.ts`,
        expectation: "Sensitive request bodies logged",
        ruleId: "sensitive_logging",
        severity: "medium",
        startLine: 53,
        endLine: 53,
      },
      {
        filepath: `${NEXTJS_CASE}/app/api/tokens/route.ts`,
        expectation: "Plaintext API tokens logged",
        ruleId: "sensitive_logging",
        severity: "high",
        startLine: 22,
        endLine: 22,
      },
      {
        filepath: `${NEXTJS_CASE}/app/api/scan/route.ts`,
        expectation: "Command output logged without redaction",
        ruleId: "command_output_logging",
        severity: "medium",
        startLine: 27,
        endLine: 27,
      },
      {
        filepath: `${NEXTJS_CASE}/app/api/admin/users/[id]/route.ts`,
        expectation: "Admin deletes lack audit log enforcement",
        ruleId: "missing_audit_logging",
        severity: "high",
        startLine: 15,
        endLine: 15,
      },
    ],
  },
  {
    id: "LOGGING-MONITORING-Nextjs-Fakeout1",
    description:
      "Logging & monitoring fakeout fixtures (Next.js) in hadrix-evals-logging-monitoring",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_FAKEOUT_1_CASE}/app/api/tokens/route.ts`,
        expectation:
          "Sensitive data in logs: redacted token logged alongside full token in metadata",
        ruleId: "sensitive_logging",
        severity: "high",
        startLine: 42,
        endLine: 42,
      },
    ],
  },
  {
    id: "LOGGING-MONITORING-Supabase-Baseline",
    description:
      "Logging & monitoring baseline fixtures (React Supabase) in hadrix-evals-logging-monitoring",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/admin-delete-user.ts`,
        expectation: "No audit logs for destructive admin action when toggle enabled",
        ruleId: "missing_audit_logging",
        severity: "high",
        startLine: 42,
        endLine: 43,
      },
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/create-api-token.ts`,
        expectation:
          "Sensitive data in logs: plaintext API token logged when toggle enabled",
        ruleId: "sensitive_logging",
        severity: "high",
        startLine: 51,
        endLine: 51,
      },
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/scan-repo.ts`,
        expectation:
          "Sensitive data in logs: logs full command and output (may include credentials in repo URLs)",
        ruleId: "command_output_logging",
        severity: "medium",
        startLine: 40,
        endLine: 41,
      },
    ],
  },
  {
    id: "LOGGING-MONITORING-BrokenCrystals",
    description: "Logging & monitoring fixtures (BrokenCrystals) in hadrix-evals-logging-monitoring",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${BROKENCRYSTALS_CASE}/server/routes/tokens.ts`,
        expectation: "Sensitive data in logs: plaintext API tokens logged",
        ruleId: "sensitive_logging",
        severity: "high",
        startLine: 6,
        endLine: 6,
      },
    ],
  },
  {
    id: "LOGGING-MONITORING-NodeGoat",
    description: "Logging & monitoring fixtures (NodeGoat) in hadrix-evals-logging-monitoring",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NODEGOAT_CASE}/server/routes/login.ts`,
        expectation: "Sensitive data in logs: plaintext credentials logged during login",
        ruleId: "sensitive_logging",
        severity: "high",
        startLine: 12,
        endLine: 12,
      },
    ],
  },
];
