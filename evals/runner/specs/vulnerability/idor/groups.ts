import type { EvalGroupSpec } from "../../../types.js";

const NEXTJS_CASE = "cases/nextjs-baseline";
const NEXTJS_FAKEOUT_1_CASE = "cases/nextjs-fakeout-1";
const SUPABASE_CASE = "cases/supabase-baseline";
const BROKENCRYSTALS_CASE = "cases/brokencrystals-baseline";
const DVWS_CASE = "cases/dvws-baseline";
const NODEGOAT_CASE = "cases/nodegoat-baseline";

export const IDOR_GROUPS: EvalGroupSpec[] = [
  {
    id: "IDOR-Nextjs-Baseline",
    description: "IDOR baseline fixtures (Next.js) in hadrix-evals-idor",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_CASE}/app/api/projects/[id]/route.ts`,
        expectation: "IDOR: project fetched by ID without verifying org membership/ownership",
        ruleId: "idor",
        severity: "high",
        startLine: 21,
        endLine: 24,
      },
    ],
  },
  {
    id: "IDOR-Nextjs-Fakeout1",
    description: "IDOR fakeout fixtures (Next.js) in hadrix-evals-idor",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_FAKEOUT_1_CASE}/app/api/projects/[id]/route.ts`,
        expectation: "IDOR: membership lookup performed but not enforced before returning project data",
        ruleId: "idor",
        severity: "high",
        startLine: 35,
        endLine: 39,
      },
    ],
  },
  {
    id: "IDOR-Supabase-Baseline",
    description: "IDOR baseline fixtures (React Supabase) in hadrix-evals-idor",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/get-project.ts`,
        expectation: "IDOR: project fetched by ID without verifying org membership/ownership",
        ruleId: "idor",
        severity: "high",
        startLine: 40,
        endLine: 44,
      },
    ],
  },
  {
    id: "IDOR-BrokenCrystals",
    description: "IDOR fixtures (BrokenCrystals) in hadrix-evals-idor",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${BROKENCRYSTALS_CASE}/server/routes/users.ts`,
        expectation: "IDOR: user record fetched by email without verifying ownership",
        ruleId: "idor",
        severity: "high",
        startLine: 10,
        endLine: 11,
      },
    ],
  },
  {
    id: "IDOR-DVWS",
    description: "IDOR fixtures (DVWS) in hadrix-evals-idor",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${DVWS_CASE}/server/routes/accounts.ts`,
        expectation: "IDOR: account fetched by ID without verifying ownership",
        ruleId: "idor",
        severity: "medium",
        startLine: 24,
        endLine: 24,
      },
    ],
  },
  {
    id: "IDOR-NodeGoat",
    description: "IDOR fixtures (NodeGoat) in hadrix-evals-idor",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NODEGOAT_CASE}/server/routes/transactions.ts`,
        expectation: "IDOR: transaction fetched by ID without verifying ownership",
        ruleId: "idor",
        severity: "medium",
        startLine: 35,
        endLine: 36,
      },
    ],
  },
];
