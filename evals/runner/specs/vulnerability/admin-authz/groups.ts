import type { EvalGroupSpec } from "../../../types.js";

const NEXTJS_CASE = "cases/nextjs-baseline";
const NEXTJS_FAKEOUT_1_CASE = "cases/nextjs-fakeout-1";
const SUPABASE_CASE = "cases/supabase-baseline";
const BROKENCRYSTALS_CASE = "cases/brokencrystals-baseline";

export const ADMIN_AUTHZ_GROUPS: EvalGroupSpec[] = [
  {
    id: "ADMIN-AUTHZ-Nextjs-Baseline",
    description: "Admin authorization baseline fixtures (Next.js) in hadrix-evals-admin-authz",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_CASE}/app/api/admin/users/route.ts`,
        expectation: "Admin list endpoint missing role checks",
        ruleId: "missing_role_check",
        severity: "critical",
      },
      {
        filepath: `${NEXTJS_CASE}/app/api/admin/users/[id]/route.ts`,
        expectation: "Admin delete endpoint missing role checks",
        ruleId: "missing_role_check",
        severity: "critical",
      },
    ],
  },
  {
    id: "ADMIN-AUTHZ-Nextjs-Fakeout1",
    description: "Admin authorization fakeout fixtures (Next.js) in hadrix-evals-admin-authz",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_FAKEOUT_1_CASE}/app/api/admin/users/route.ts`,
        expectation:
          "Admin list endpoint trusts a client-supplied role header instead of enforcing server-side admin checks",
        ruleId: "missing_role_check",
        severity: "critical",
      },
    ],
  },
  {
    id: "ADMIN-AUTHZ-Supabase-Baseline",
    description: "Admin authorization baseline fixtures (React Supabase) in hadrix-evals-admin-authz",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/admin-delete-user.ts`,
        expectation: "Admin action without role check: deletes arbitrary users",
        ruleId: "missing_role_check",
        severity: "critical",
      },
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/admin-list-users.ts`,
        expectation: "Admin data exposure: lists all profiles without server-side role check",
        ruleId: "missing_role_check",
        severity: "high",
      },
    ],
  },
  {
    id: "ADMIN-AUTHZ-BrokenCrystals",
    description: "Admin authorization fixtures (BrokenCrystals) in hadrix-evals-admin-authz",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${BROKENCRYSTALS_CASE}/server/routes/adminUsers.ts`,
        expectation: "Admin endpoint updates user roles without verifying admin privileges",
        ruleId: "missing_role_check",
        severity: "high",
      },
    ],
  },
];
