import type { EvalGroupSpec } from "../../../types.js";

const NEXTJS_PUBLIC_CASE = "cases/nextjs-public-uploads";
const NEXTJS_CSV_CASE = "cases/nextjs-csv-import";
const EXPRESS_CASE = "cases/express-plugin-upload";

export const FILE_UPLOAD_GROUPS: EvalGroupSpec[] = [
  {
    id: "FILE-UPLOAD-Nextjs-Public",
    description: "File upload fixtures (Next.js public uploads) in hadrix-evals-file-upload",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_PUBLIC_CASE}/app/api/uploads/route.ts`,
        expectation:
          "Upload handler stores arbitrary files in a public directory using the original filename",
        ruleId: "unrestricted_file_upload",
        severity: "high",
        startLine: 20,
        endLine: 20,
      },
    ],
  },
  {
    id: "FILE-UPLOAD-Nextjs-Csv",
    description: "File upload fixtures (Next.js CSV import) in hadrix-evals-file-upload",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_CSV_CASE}/app/api/import/route.ts`,
        expectation: "CSV import accepts uploaded files without enforcing size limits",
        ruleId: "missing_upload_size_limit",
        severity: "medium",
        startLine: 33,
        endLine: 33,
      },
    ],
  },
  {
    id: "FILE-UPLOAD-Express-Plugins",
    description: "File upload fixtures (Express plugin uploads) in hadrix-evals-file-upload",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${EXPRESS_CASE}/server/routes/plugins.ts`,
        expectation:
          "Plugin upload uses a user-controlled filename in the write path, enabling path traversal",
        ruleId: "path_traversal",
        severity: "high",
        startLine: 23,
        endLine: 23,
      },
    ],
  },
];
