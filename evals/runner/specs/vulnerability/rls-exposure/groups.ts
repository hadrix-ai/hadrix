import type { EvalGroupSpec } from "../../../types.js";

const NEXTJS_CASE = "cases/nextjs-baseline";
const NEXTJS_FAKEOUT_1_CASE = "cases/nextjs-fakeout-1";
const SUPABASE_CASE = "cases/supabase-baseline";
const BROKENCRYSTALS_CASE = "cases/brokencrystals-baseline";

export const RLS_EXPOSURE_GROUPS: EvalGroupSpec[] = [
  {
    id: "RLS-EXPOSURE-Nextjs-Baseline",
    description: "RLS exposure baseline fixtures (Next.js) in hadrix-evals-rls-exposure",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_CASE}/db/rls.sql`,
        expectation: "Permissive RLS policies allow unrestricted access",
        ruleId: "weak_rls_policies",
        severity: "high",
      },
    ],
  },
  {
    id: "RLS-EXPOSURE-Nextjs-Fakeout1",
    description: "RLS exposure fakeout fixtures (Next.js) in hadrix-evals-rls-exposure",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_FAKEOUT_1_CASE}/db/rls.sql`,
        expectation: "Permissive audit log RLS policies allow unrestricted reads and inserts",
        ruleId: "weak_rls_policies",
        severity: "high",
      },
    ],
  },
  {
    id: "RLS-EXPOSURE-Supabase-Baseline",
    description: "RLS exposure baseline fixtures (React Supabase) in hadrix-evals-rls-exposure",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${SUPABASE_CASE}/datastores/supabase/mock/schema.json`,
        expectation: "RLS disabled on public.test_no_rls while client roles have access",
        ruleId: "supabase_rls_disabled",
        severity: "high",
      },
      {
        filepath: `${SUPABASE_CASE}/datastores/supabase/mock/schema.json`,
        expectation: "RLS enabled but no policies defined for public.test_rls_no_policy",
        ruleId: "supabase_rls_no_policies",
        severity: "low",
      },
    ],
  },
  {
    id: "RLS-EXPOSURE-BrokenCrystals",
    description: "RLS exposure fixtures (BrokenCrystals) in hadrix-evals-rls-exposure",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${BROKENCRYSTALS_CASE}/db/rls.sql`,
        expectation: "Permissive RLS policy allows unrestricted access",
        ruleId: "weak_rls_policies",
        severity: "high",
      },
    ],
  },
];
