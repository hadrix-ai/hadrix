import type { EvalGroupSpec } from "../../../types.js";

const NEXTJS_CASE = "cases/nextjs-baseline";
const NEXTJS_FAKEOUT_1_CASE = "cases/nextjs-fakeout-1";
const SUPABASE_CASE = "cases/supabase-baseline";
const BROKENCRYSTALS_CASE = "cases/brokencrystals-baseline";
const NODEVULNERABLE_CASE = "cases/nodevulnerable-baseline";

export const SQL_INJECTION_GROUPS: EvalGroupSpec[] = [
  {
    id: "SQLI-Nextjs-Baseline",
    description: "SQL injection baseline fixtures (Next.js) in hadrix-evals-sql-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_CASE}/app/api/projects/[id]/route.ts`,
        expectation: "SQL injection: raw SQL built by concatenating the project id into a query string",
        ruleId: "sql_injection",
        severity: "critical",
        startLine: 17,
        endLine: 19,
      },
      {
        filepath: `${NEXTJS_CASE}/lib/unsafeSql.ts`,
        expectation: "Unsafe raw SQL execution helper used by Next.js route handlers",
        ruleId: "sql_injection",
        severity: "high",
        startLine: 4,
        endLine: 8,
      },
      {
        filepath: `${NEXTJS_CASE}/app/api/projects/route.ts`,
        expectation:
          "Unsafe query-builder usage: user-controlled `.or()` filter string passed to Supabase query builder",
        ruleId: "unsafe_query_builder",
        severity: "high",
        startLine: 19,
        endLine: 20,
      },
    ],
  },
  {
    id: "SQLI-Nextjs-Fakeout1",
    description: "SQL injection fakeout fixtures (Next.js) in hadrix-evals-sql-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NEXTJS_FAKEOUT_1_CASE}/app/api/projects/[id]/route.ts`,
        expectation: "SQL injection: raw SQL built by interpolating the project id into a WHERE clause",
        ruleId: "sql_injection",
        severity: "critical",
        startLine: 15,
        endLine: 16,
      },
      {
        filepath: `${NEXTJS_FAKEOUT_1_CASE}/lib/queryExecutor.ts`,
        expectation: "Raw SQL execution helper runs unparameterized SQL statements",
        ruleId: "sql_injection",
        severity: "high",
        startLine: 1,
        endLine: 2,
      },
    ],
  },
  {
    id: "SQLI-Supabase-Baseline",
    description: "SQL injection baseline fixtures (React Supabase) in hadrix-evals-sql-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/get-project.ts`,
        expectation: "SQL injection: raw SQL built by concatenating the project id into a query string",
        ruleId: "sql_injection",
        severity: "critical",
        startLine: 46,
        endLine: 48,
      },
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/_shared/unsafeSql.ts`,
        expectation: "Unsafe raw SQL execution helper used by Edge Functions (no parameterization)",
        ruleId: "sql_injection",
        severity: "high",
        startLine: 25,
        endLine: 27,
      },
      {
        filepath: `${SUPABASE_CASE}/backend/supabase/functions/list-projects.ts`,
        expectation:
          "Unsafe query-builder usage: user-controlled `.or()` filter string passed directly to PostgREST query builder",
        ruleId: "unsafe_query_builder",
        severity: "high",
        startLine: 33,
        endLine: 35,
      },
    ],
  },
  {
    id: "SQLI-BrokenCrystals",
    description: "SQL injection fixtures (BrokenCrystals) in hadrix-evals-sql-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${BROKENCRYSTALS_CASE}/server/routes/testimonials.ts`,
        expectation: "SQL injection: raw SQL built by concatenating the search term into the WHERE clause",
        ruleId: "sql_injection",
        severity: "critical",
        startLine: 12,
        endLine: 13,
      },
    ],
  },
  {
    id: "SQLI-NodeVulnerable",
    description: "SQL injection fixtures (NodeVulnerable) in hadrix-evals-sql-injection",
    allowUnexpected: true,
    expectedFindings: [
      {
        filepath: `${NODEVULNERABLE_CASE}/server/routes/orders.ts`,
        expectation: "SQL injection: raw SQL built by concatenating the user id into the WHERE clause",
        ruleId: "sql_injection",
        severity: "critical",
        startLine: 18,
        endLine: 20,
      },
      {
        filepath: `${NODEVULNERABLE_CASE}/server/db/unsafeSql.ts`,
        expectation: "Unsafe raw SQL execution helper used by NodeVulnerable routes (no parameterization)",
        ruleId: "sql_injection",
        severity: "high",
        startLine: 4,
        endLine: 6,
      },
    ],
  },
];
